<div>
    <!-- Header -->
    <div class="mb-4">
        <Button
            label="Voltar"
            icon="pi pi-arrow-left"
            text
            @click="$emit('voltar')"
            class="mb-3 back-button"
        />
        <div class="flex align-items-center justify-content-between">
            <div>
                <h2 class="text-2xl font-bold text-gray-800 mb-2">
                    Administração
                </h2>
                <p class="text-gray-600">Gerencie os temas de votação</p>
            </div>
            <Button
                label="Novo Tema"
                icon="pi pi-plus"
                @click="abrirDialogNovoTema"
                class="new-theme-button"
            />
        </div>
    </div>

    <!-- Loading -->
    <div v-if="loading" class="flex justify-content-center p-4">
        <i class="pi pi-spin pi-spinner text-4xl text-primary"></i>
    </div>

    <!-- Error -->
    <div v-else-if="error" class="p-4 bg-red-50 border-round border-red-200">
        <div class="flex align-items-center">
            <i class="pi pi-exclamation-triangle text-red-500 mr-2"></i>
            <span class="text-red-700">{{ error }}</span>
        </div>
    </div>

    <!-- Tabela de Temas -->
    <div v-else>
        <DataTable
            :value="temas"
            :paginator="true"
            :rows="10"
            :rowsPerPageOptions="[5, 10, 20]"
            paginatorTemplate="FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown"
            currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} temas"
            responsiveLayout="scroll"
            class="p-datatable-sm admin-table"
        >
            <Column field="nome" header="Nome" sortable>
                <template #body="{ data }">
                    <div class="flex align-items-center">
                        <Image
                            :src="data.foto"
                            :alt="data.nome"
                            width="50"
                            height="50"
                            preview
                            class="mr-3 border-round tema-thumbnail"
                        />
                        <div>
                            <div class="font-semibold">{{ data.nome }}</div>
                            <div class="text-sm text-gray-500">
                                {{ truncateDescription(data.descricao, 50) }}
                            </div>
                        </div>
                    </div>
                </template>
            </Column>

            <Column field="created_at" header="Criado em" sortable>
                <template #body="{ data }">
                    {{ formatDate(data.created_at) }}
                </template>
            </Column>

            <Column field="totalVotos" header="Votos" sortable>
                <template #body="{ data }">
                    <Tag :value="data.totalVotos || 0" severity="info" />
                </template>
            </Column>

            <Column field="ativo" header="Status" sortable>
                <template #body="{ data }">
                    <Tag
                        :value="data.ativo ? 'Ativo' : 'Inativo'"
                        :severity="data.ativo ? 'success' : 'danger'"
                    />
                </template>
            </Column>

            <Column header="Ações" style="width: 200px">
                <template #body="{ data }">
                    <div class="flex gap-2">
                        <Button
                            icon="pi pi-eye"
                            text
                            size="small"
                            @click="verDetalhes(data)"
                            v-tooltip.top="'Ver detalhes'"
                            class="action-button"
                        />
                        <Button
                            icon="pi pi-pencil"
                            text
                            size="small"
                            @click="editarTema(data)"
                            v-tooltip.top="'Editar'"
                            class="action-button"
                        />
                        <Button
                            v-if="data.ativo"
                            icon="pi pi-lock"
                            text
                            size="small"
                            severity="danger"
                            @click="inativarTema(data)"
                            v-tooltip.top="'Desativar'"
                            class="action-button"
                        />
                        <Button
                            v-else
                            icon="pi pi-lock-open"
                            text
                            size="small"
                            severity="success"
                            @click="ativarTema(data)"
                            v-tooltip.top="'Ativar'"
                            class="action-button"
                        />
                    </div>
                </template>
            </Column>
        </DataTable>
    </div>

    <!-- Dialog Novo/Editar Tema -->
    <Dialog
        v-model:visible="dialogVisible"
        :header="editando ? 'Editar Tema' : 'Novo Tema'"
        modal
        class="p-fluid theme-dialog"
        :style="{ width: '600px' }"
    >
        <div class="formgrid grid">
            <div class="field col-12">
                <label for="nome" class="font-semibold mb-2">Nome do Tema</label>
                <InputText
                    id="nome"
                    v-model="form.nome"
                    placeholder="Digite o nome do tema"
                    :class="{ 'p-invalid': errors.nome }"
                    fluid 
                />
                <small v-if="errors.nome" class="p-error">{{ errors.nome }}</small>
            </div>

            <div class="field col-12">
                <label for="descricao" class="font-semibold mb-2">Descrição</label>
                <Textarea
                    id="descricao"
                    v-model="form.descricao"
                    rows="4"
                    placeholder="Digite a descrição do tema"
                    :class="{ 'p-invalid': errors.descricao }"
                    fluid 
                />
                <small v-if="errors.descricao" class="p-error">{{ errors.descricao }}</small>
            </div>

            <div class="field col-12">
                <label for="foto" class="font-semibold mb-2">URL da Foto</label>
                <InputText
                    id="foto"
                    v-model="form.foto"
                    placeholder="https://exemplo.com/foto.jpg"
                    :class="{ 'p-invalid': errors.foto }"
                />
                <small v-if="errors.foto" class="p-error">{{ errors.foto }}</small>
            </div>

            <div class="field col-12" v-if="form.foto">
                <label class="font-semibold mb-2">Preview da Foto</label>
                <div class="border-round overflow-hidden" style="max-width: 200px">
                    <Image
                        :src="form.foto"
                        :alt="form.nome"
                        width="100%"
                        height="150px"
                        preview
                    />
                </div>
            </div>
        </div>

        <template #footer>
            <Button
                label="Cancelar"
                icon="pi pi-times"
                text
                @click="fecharDialog"
                class="cancel-button"
            />
            <Button
                :label="editando ? 'Atualizar' : 'Criar'"
                icon="pi pi-check"
                @click="salvarTema"
                :loading="salvando"
                class="save-button"
            />
        </template>
    </Dialog>

    <!-- Dialog Detalhes -->
    <Dialog
        v-model:visible="dialogDetalhesVisible"
        header="Detalhes do Tema"
        modal
        class="details-dialog"
        :style="{ width: '800px' }"
    >
        <div v-if="temaSelecionado" class="grid">
            <div class="col-12">
                <Image
                    :src="temaSelecionado.foto"
                    :alt="temaSelecionado.nome"
                    width="100%"
                    height="300px"
                    preview
                    class="border-round mb-3"
                />
            </div>

            <div class="col-12">
                <h3 class="text-xl font-semibold mb-2">
                    {{ temaSelecionado.nome }}
                </h3>
                <p class="text-gray-600 mb-3">
                    {{ temaSelecionado.descricao }}
                </p>

                <div class="grid">
                    <div class="col-6">
                        <div class="text-sm text-gray-500">Criado em</div>
                        <div class="font-semibold">
                            {{ formatDate(temaSelecionado.created_at) }}
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="text-sm text-gray-500">Total de votos</div>
                        <div class="font-semibold">
                            {{ temaSelecionado.totalVotos || 0 }}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </Dialog>
</div> 