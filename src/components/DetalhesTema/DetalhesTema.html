<div>
    <!-- Header -->
    <div class="mb-4">
        <div class="flex align-items-center justify-content-between mb-3">
            <div class="flex align-items-center gap-3">
                <Button
                    label="Voltar"
                    icon="pi pi-arrow-left"
                    @click="$emit('voltar')"
                    severity="secondary"
                    outlined
                    class="font-semibold"
                ></Button>
                <h2 class="text-2xl font-bold  m-0">
                    {{ editando ? 'Editar Tema' : 'Detalhes do Tema' }}
                </h2>
            </div>
            <div class="flex gap-2">
                <Button
                    v-if="!editando"
                    :label="tema.ativo ? 'Desativar Tema' : 'Ativar Tema'"
                    :icon="tema.ativo ? 'pi pi-lock' : 'pi pi-lock-open'"
                    :severity="tema.ativo ? 'danger' : 'success'"
                    @click="toggleStatusTema"
                    :loading="alterandoStatus"
                    outlined
                />
                <Button
                    v-if="!editando"
                    label="Editar"
                    icon="pi pi-pencil"
                    @click="iniciarEdicao"
                    severity="secondary"
                />
                <Button
                    v-if="editando"
                    label="Cancelar"
                    icon="pi pi-times"
                    text
                    @click="cancelarEdicao"
                />
                <Button
                    v-if="editando"
                    label="Salvar"
                    icon="pi pi-check"
                    @click="salvarAlteracoes"
                    :loading="salvando"
                />
            </div>
        </div>
    </div>

    <div v-if="tema" class="grid">
        <!-- Imagem e Informações -->
        <div class="col-12 lg:col-6">
            <Card>
                <template #header>
                    <div class="relative">
                        <Image
                            :src="editando ? form.foto : tema.foto"
                            :alt="editando ? form.nome : tema.nome"
                            width="100%"
                            height="200px"
                            preview
                            class="w-full border-round-top"
                        />
                        <Tag
                            v-if="!editando && !tema.ativo"
                            value="Inativo"
                            severity="danger"
                            class="absolute top-0 right-0 m-3"
                        />
                        <Tag
                            v-if="!editando && tema.ativo"
                            value="Ativo"
                            severity="success"
                            class="absolute top-0 right-0 m-3"
                        />
                    </div>
                </template>

                <template #title>
                    <div v-if="!editando">
                        <h1 class="text-3xl font-bold  mb-3">
                            {{ tema.nome }}
                        </h1>
                    </div>
                    <div v-else>
                        <div class="mb-3">
                            <label for="nome" class="block text-sm font-semibold mb-2">
                                Nome do Tema
                            </label>
                            <InputText
                                id="nome"
                                v-model="form.nome"
                                placeholder="Digite o nome do tema"
                                class="w-full"
                                :class="{ 'p-invalid': errors.nome }"
                            />
                            <small v-if="errors.nome" class="p-error">
                                {{ errors.nome }}
                            </small>
                        </div>
                    </div>
                </template>

                <template #content>
                    <div v-if="!editando">
                        <div class="mb-4">
                            <h3 class="text-lg font-semibold mb-2">
                                Descrição
                            </h3>
                            <p class="line-height-3">
                                {{ tema.descricao }}
                            </p>
                        </div>
                    </div>
                    <div v-else>
                        <div class="mb-4">
                            <label for="descricao" class="block text-sm font-semibold mb-2">
                                Descrição
                            </label>
                            <textarea
                                id="descricao"
                                v-model="form.descricao"
                                placeholder="Digite a descrição do tema"
                                rows="4"
                                class="w-full"
                                :class="{ 'p-invalid': errors.descricao }"
                            ></textarea>
                            <small v-if="errors.descricao" class="p-error">
                                {{ errors.descricao }}
                            </small>
                        </div>

                        <div class="mb-4">
                            <label for="foto" class="block text-sm font-semibold mb-2">
                                URL da Imagem
                            </label>
                            <InputText
                                id="foto"
                                v-model="form.foto"
                                placeholder="Digite a URL da imagem"
                                class="w-full"
                                :class="{ 'p-invalid': errors.foto }"
                            />
                            <small v-if="errors.foto" class="p-error">
                                {{ errors.foto }}
                            </small>
                        </div>
                    </div>

                    <Divider />

                    <div class="grid">
                        <div class="col-12 md:col-6">
                            <div class="flex align-items-center mb-3">
                                <i class="pi pi-calendar text-primary mr-2"></i>
                                <div>
                                    <div class="text-sm">Criado em</div>
                                    <div class="font-semibold">{{ formatDate(tema.dataCriacao) }}</div>
                                </div>
                            </div>
                        </div>

                        <div class="col-12 md:col-6">
                            <div class="flex align-items-center mb-3">
                                <i class="pi pi-users text-primary mr-2"></i>
                                <div>
                                    <div class="text-sm">Total de votos</div>
                                    <div class="font-semibold text-xl">{{ totalVotos }}</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div v-if="!editando && !tema.ativo" class="mt-4">
                        <div class="flex align-items-center mb-3">
                            <i class="pi pi-ban text-red-500 mr-2"></i>
                            <div>
                                <div class="text-sm">Status</div>
                                <div class="font-semibold text-red-600">Tema Inativo</div>
                            </div>
                        </div>
                    </div>
                </template>

                <template #footer>
                    <div class="flex gap-3">
                        <Button
                            v-if="!editando && tema.ativo"
                            label="Votar neste tema"
                            icon="pi pi-check"
                            size="large"
                            @click="votar"
                            :loading="votando"
                            class="flex-1"
                        />
                        <Button
                            v-if="!editando && !tema.ativo"
                            label="Tema Inativo"
                            icon="pi pi-ban"
                            severity="secondary"
                            disabled
                            class="flex-1"
                        />
                    </div>
                </template>
            </Card>
        </div>

        <!-- Estatísticas e Lista de Votos -->
        <div class="col-12 lg:col-4">
            <Card>
                <template #title>
                    <h3 class="text-xl font-semibold  mb-3">
                        Estatísticas e Votos
                    </h3>
                </template>

                <template #content>
                    <div class="space-y-4">
                        <!-- Total de Votos -->
                        <div class="text-center p-4 surface-50 border-round">
                            <div class="text-3xl font-bold text-blue-600 mb-1">
                                {{ totalVotos }}
                            </div>
                            <div class="text-sm text-blue-700">
                                Total de Votos
                            </div>
                        </div>

                        <!-- Progresso -->
                        <div v-if="percentual > 0" class="space-y-2">
                            <div class="flex justify-content-between text-sm">
                                <span class="">Percentual</span>
                                <span class="font-semibold">{{ percentual.toFixed(1) }}%</span>
                            </div>
                            <ProgressBar
                                :value="percentual"
                                :showValue="false"
                                class="h-2"
                            />
                        </div>

                        <!-- Lista de Votos -->
                        <div v-if="ultimosVotos.length > 0">
                            <h4 class="font-semibold mb-2">
                                Últimos Votos ({{ ultimosVotos.length }})
                            </h4>
                            <div class="space-y-2 max-h-64 overflow-y-auto">
                                <div
                                    v-for="voto in ultimosVotos"
                                    :key="voto.id"
                                    class="flex align-items-center justify-content-between p-3 bg-gray-50 border-round hover:bg-gray-100 transition-colors"
                                >
                                    <div class="flex align-items-center">
                                        <i class="pi pi-user mr-2"></i>
                                        <div>
                                            <div class="text-sm font-medium ">
                                                IP: {{ voto.ip }}
                                            </div>
                                            <div class="text-xs">
                                                {{ formatDate(voto.dataHora) }}
                                            </div>
                                        </div>
                                    </div>
                                    <div class="text-xs ">
                                        #{{ voto.id }}
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Mensagem quando não há votos -->
                        <div v-else class="text-center p-4 bg-gray-50 border-round">
                            <i class="pi pi-users text-2xl mb-2"></i>
                            <div class="text-sm">
                                Nenhum voto registrado ainda
                            </div>
                        </div>
                    </div>
                </template>
            </Card>
        </div>
    </div>
</div>