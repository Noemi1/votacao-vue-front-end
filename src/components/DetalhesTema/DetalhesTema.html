<div>
    <!-- Header -->
    <div class="mb-4">
        <button
            label="Voltar"
            icon="pi pi-arrow-left"
            text
            @click="$emit('voltar')"
            class="mb-3"
        />
        <div class="flex align-items-center justify-content-between">
            <h2 class="text-2xl font-bold text-gray-800 mb-2">
                {{ editando ? 'Editar Tema' : 'Detalhes do Tema' }}
            </h2>
            <div class="flex gap-2">
                <button
                    v-if="!editando"
                    label="Editar"
                    icon="pi pi-pencil"
                    @click="iniciarEdicao"
                    severity="secondary"
                />
                <button
                    v-if="editando"
                    label="Cancelar"
                    icon="pi pi-times"
                    text
                    @click="cancelarEdicao"
                />
                <button
                    v-if="editando"
                    label="Salvar"
                    icon="pi pi-check"
                    @click="salvarAlteracoes"
                    :loading="salvando"
                />
            </div>
        </div>
    </div>

    <div v-if="tema" class="grid">
        <!-- Imagem e Informações -->
        <div class="col-12 lg:col-8">
            <Card>
                <template #header>
                    <div class="relative">
                        <image
                            :src="editando ? form.foto : tema.foto"
                            :alt="editando ? form.nome : tema.nome"
                            width="100%"
                            height="400px"
                            preview
                            class="w-full border-round-top"
                        />
                        <Tag
                            v-if="!editando && tema.inativado"
                            value="Inativo"
                            severity="danger"
                            class="absolute top-0 right-0 m-3"
                        />
                    </div>
                </template>

                <template #title>
                    <div v-if="!editando">
                        <h1 class="text-3xl font-bold text-gray-800 mb-3">
                            {{ tema.nome }}
                        </h1>
                    </div>
                    <div v-else>
                        <div class="mb-3">
                            <label
                                for="nome"
                                class="block text-sm font-semibold text-gray-700 mb-2"
                                >Nome do Tema</label
                            >
                            <InputText
                                id="nome"
                                v-model="form.nome"
                                placeholder="Digite o nome do tema"
                                class="w-full"
                                :class="{ 'p-invalid': errors.nome }"
                            />
                            <small v-if="errors.nome" class="p-error"
                                >{{ errors.nome }}</small
                            >
                        </div>
                    </div>
                </template>

                <template #content>
                    <div v-if="!editando">
                        <div class="mb-4">
                            <h3
                                class="text-lg font-semibold text-gray-700 mb-2"
                            >
                                Descrição
                            </h3>
                            <p class="text-gray-600 line-height-3">
                                {{ tema.descricao }}
                            </p>
                        </div>
                    </div>
                    <div v-else>
                        <div class="mb-4">
                            <label
                                for="descricao"
                                class="block text-sm font-semibold text-gray-700 mb-2"
                                >Descrição</label
                            >
                            <textarea
                                id="descricao"
                                v-model="form.descricao"
                                placeholder="Digite a descrição do tema"
                                rows="4"
                                class="w-full"
                                :class="{ 'p-invalid': errors.descricao }"
                            />
                            <small v-if="errors.descricao" class="p-error"
                                >{{ errors.descricao }}</small
                            >
                        </div>

                        <div class="mb-4">
                            <label
                                for="foto"
                                class="block text-sm font-semibold text-gray-700 mb-2"
                                >URL da Imagem</label
                            >
                            <InputText
                                id="foto"
                                v-model="form.foto"
                                placeholder="Digite a URL da imagem"
                                class="w-full"
                                :class="{ 'p-invalid': errors.foto }"
                            />
                            <small v-if="errors.foto" class="p-error"
                                >{{ errors.foto }}</small
                            >
                        </div>
                    </div>

                    <Divider />

                    <div class="grid">
                        <div class="col-12 md:col-6">
                            <div class="flex align-items-center mb-3">
                                <i class="pi pi-calendar text-primary mr-2"></i>
                                <div>
                                    <div class="text-sm text-gray-500">
                                        Criado em
                                    </div>
                                    <div class="font-semibold">
                                        {{ formatDate(tema.created_at) }}
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-12 md:col-6">
                            <div class="flex align-items-center mb-3">
                                <i class="pi pi-users text-primary mr-2"></i>
                                <div>
                                    <div class="text-sm text-gray-500">
                                        Total de votos
                                    </div>
                                    <div class="font-semibold text-xl">
                                        {{ totalVotos }}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div v-if="!editando && tema.inativado" class="mt-4">
                        <div class="flex align-items-center mb-3">
                            <i class="pi pi-ban text-red-500 mr-2"></i>
                            <div>
                                <div class="text-sm text-gray-500">
                                    Inativado em
                                </div>
                                <div class="font-semibold text-red-600">
                                    {{ formatDate(tema.inativado_em) }}
                                </div>
                            </div>
                        </div>
                        <div class="text-sm text-gray-500">
                            IP de inativação: {{ tema.inativado_por_ip }}
                        </div>
                    </div>
                </template>

                <template #footer>
                    <div class="flex gap-3">
                        <button
                            v-if="!editando && !tema.inativado"
                            label="Votar neste tema"
                            icon="pi pi-check"
                            size="large"
                            @click="votar"
                            :loading="votando"
                            class="flex-1"
                        />
                        <button
                            v-if="!editando && tema.inativado"
                            label="Tema Inativo"
                            icon="pi pi-ban"
                            severity="secondary"
                            disabled
                            class="flex-1"
                        />
                    </div>
                </template>
            </Card>
        </div>

        <!-- Estatísticas -->
        <div class="col-12 lg:col-4">
            <Card>
                <template #title>
                    <h3 class="text-xl font-semibold text-gray-800 mb-3">
                        Estatísticas
                    </h3>
                </template>

                <template #content>
                    <div class="space-y-4">
                        <!-- Total de Votos -->
                        <div class="text-center p-4 bg-blue-50 border-round">
                            <div class="text-3xl font-bold text-blue-600 mb-1">
                                {{ totalVotos }}
                            </div>
                            <div class="text-sm text-blue-700">
                                Total de Votos
                            </div>
                        </div>

                        <!-- Progresso (se houver outros temas para comparação) -->
                        <div v-if="percentual > 0" class="space-y-2">
                            <div class="flex justify-content-between text-sm">
                                <span class="text-gray-600">Percentual</span>
                                <span class="font-semibold"
                                    >{{ percentual.toFixed(1) }}%</span
                                >
                            </div>
                            <ProgressBar
                                :value="percentual"
                                :showValue="false"
                                class="h-2"
                            />
                        </div>

                        <!-- Últimos Votos -->
                        <div v-if="ultimosVotos.length > 0">
                            <h4 class="font-semibold text-gray-700 mb-2">
                                Últimos Votos
                            </h4>
                            <div class="space-y-2">
                                <div
                                    v-for="voto in ultimosVotos.slice(0, 5)"
                                    :key="voto.id"
                                    class="flex align-items-center justify-content-between p-2 bg-gray-50 border-round"
                                >
                                    <div class="flex align-items-center">
                                        <i
                                            class="pi pi-user text-gray-400 mr-2"
                                        ></i>
                                        <span class="text-sm text-gray-600"
                                            >{{ voto.ip }}</span
                                        >
                                    </div>
                                    <span class="text-xs text-gray-500"
                                        >{{ formatDate(voto.created_at) }}</span
                                    >
                                </div>
                            </div>
                        </div>
                    </div>
                </template>
            </Card>
        </div>
    </div>
</div>
